on:
  schedule:
    # Runs at 04:00 am
    - cron: '0 4 * * *'
  workflow_dispatch:
  # delete this before merging the PR
  pull_request:
# Generates a list of libraries that cannot be
# compiled (printed to the action stdout)
name: Verify libraries compilation
jobs:
  verify:
    runs-on: 'ubuntu-24.04'
    continue-on-error: true
    strategy:
      matrix:
        # We will parallelize by alphabet letter
        letter: ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z']
      fail-fast: false
    outputs:
      failed_libraries:
    steps:
      - uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 8
      - uses: actions/checkout@v2
        with:
          path: google-api-java-client-services

      - working-directory: google-api-java-client-services
        run: |
          set -ex
          bash .github/workflows/verify.sh "${{matrix.letter}}"
  print_results:
    runs-on: 'ubuntu-24.04'
    needs: [verify]
    steps:
      - run: |
          set -ex
          echo '${{ toJSON(needs.verify.failed_libraries) }}'


