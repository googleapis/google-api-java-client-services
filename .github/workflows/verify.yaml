on:
  schedule:
    # Runs at 04:00 am
    - cron: '0 4 * * *'
  workflow_dispatch:
  # delete this before merging the PR
  pull_request:
# Generates a list of libraries that cannot be
# compiled (printed to the action stdout)
name: Verify libraries compilation
jobs:
  verify:
    runs-on: 'ubuntu-24.04'
    strategy:
      matrix:
        # We will parallelize by alphabet letter
        ascii_code: ${{ range(97, 102) }}
        fail-fast: false
    outputs:
      failed_libraries:
    steps:
      - uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 8
      - uses: actions/checkout@v2
        with:
          path: google-api-java-client-services

      - working-directory: google-api-java-client-services
        run: |
          set -ex
          bash .github/workflows/verify.sh "$(printf "\x$(printf %x ${{ matrix.ascii_code }})")"
  print_results:
    needs: [verify]
    steps:
      - run: |
          set -ex
          echo '${{ toJSON(needs.verify.failed_libraries) }}'


